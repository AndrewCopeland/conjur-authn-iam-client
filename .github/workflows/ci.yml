name: conjur-authn-iam-client CI

on: [push, pull_request]

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      # - name: Lint pkg dir
      #   uses: Jerome1337/golint-action@v1.0.2
      #   with:
      #     golint-path: './pkg/...'
      - name: Lint cmd dir
        uses: Jerome1337/golint-action@v1.0.2
        with:
          golint-path: './cmd/...'
  
  # test:
  #   name: Unit Tests
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout source code
  #       uses: actions/checkout@v2
  #     - name: Run go test
  #       run: go test -v ./...

  build:
    name: Build Release Executables
    runs-on: ubuntu-latest
    needs:
      - lint
      # - test
    defaults:
      run:
        shell: bash
    steps:
      - name: Checkout source code
        uses: actions/checkout@v2
      - name: Export GO111MODULE environment variable
        run: export GO111MODULE=on
      - name: Create ./bin/ directory
        run: mkdir -p bin
      - name: Build x64 Linux Executable
        run: |
          go get -d ./...
          CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o ./bin/linux_authenticator ./cmd/authenticator/
      - name: Build x64 MacOS Executable
        run: |
          CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -o ./bin/darwin_authenticator ./cmd/authenticator/
      - name: Build x64 Windows Executable
        run: |
          CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -o ./bin/windows_authenticator.exe ./cmd/authenticator/
      - name: Upload Artifacts to Workflow
        uses: actions/upload-artifact@v2
        with:
          name: Release Executables
          path: |
            ./bin/*_authenticator*
          if_no_files_found: error